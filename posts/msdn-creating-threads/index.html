<!DOCTYPE html><html lang="ko" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="[MSDN] Creating Threads" /><meta property="og:locale" content="ko" /><meta name="description" content="Creating Threads - Win32 apps" /><meta property="og:description" content="Creating Threads - Win32 apps" /><link rel="canonical" href="https://kangsangyeon.github.io/posts/msdn-creating-threads/" /><meta property="og:url" content="https://kangsangyeon.github.io/posts/msdn-creating-threads/" /><meta property="og:site_name" content="kangsangyeon" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-03-15T16:55:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[MSDN] Creating Threads" /><meta name="google-site-verification" content="idB845j5JM1YkVY8Yu1xeTPMGtzgq_8yqyG09LQzakw" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-03-15T16:55:00+09:00","datePublished":"2022-03-15T16:55:00+09:00","description":"Creating Threads - Win32 apps","headline":"[MSDN] Creating Threads","mainEntityOfPage":{"@type":"WebPage","@id":"https://kangsangyeon.github.io/posts/msdn-creating-threads/"},"url":"https://kangsangyeon.github.io/posts/msdn-creating-threads/"}</script><title>[MSDN] Creating Threads | kangsangyeon</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="kangsangyeon"><meta name="application-name" content="kangsangyeon"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/thumb_molang.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">kangsangyeon</a></div><div class="site-subtitle font-italic">studying game development</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span></span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/kangsangyeon" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/" aria-label="twitter" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['ksyline1997','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> </a> </span> <span>[MSDN] Creating Threads</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="..."> </span> <span id="search-cancel" ></span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>[MSDN] Creating Threads</h1><div class="post-meta text-muted"> <span> <em class="" data-ts="1647330900" data-df="DD/MM/YYYY" data-toggle="tooltip" data-placement="bottom"> 15/03/2022 </em> </span><div class="d-flex justify-content-between"> <span> <em> <a href="https://github.com/kangsangyeon">kangsangyeon</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1677 "> <em>9 </em> </span></div></div></div><div class="post-content"><p><a href="https://docs.microsoft.com/en-us/windows/win32/procthread/creating-threads">Creating Threads - Win32 apps</a></p><p>CreateThread 함수는 프로세스에 새로운 스레드를 생성합니다. 생성된 스레드는 반드시 새로운 스레드가 실행할 코드의 시작 주소를 지정해야 합니다. 일반적으로, 시작 주소는 프로그램 코드에 정의된 함수의 이름입니다 (자세한 내용은 ThreadProc 참조). 이 함수는 단일 파라미터를 받으며 DWORD 값을 반환합니다. 프로세스는 동일한 함수를 실행하는 여러 개의 스레드를 동시에 가질 수 있습니다.</p><p>아래는 지역적으로 정의된 함수 <em>MyThreadFunction</em>을 실행하는 새로운 스레드를 생성하는 방법에 대한 간단한 예제를 보여줍니다.</p><p>호출 스레드는 WaitForMultipleObjects 함수를 호출하여 모든 작업자 스레드가 종료될 때까지 지연할 수 있습니다. 대기하는 동안 호출 스레드가 블로킹됩니다. 처리를 계속하려면, 호출 스레드는 WaitForSingleObject를 사용하고 각 작업자 스레드가 wait object에 신호를 보낼 때까지 기다립니다. 종료되기 전에 작업자 스레드에 대한 핸들을 닫으려고 하는 경우, 작업자 스레드를 종료하지 않는다는 것에 유의하세요. 그러나 후속 함수 호출에서는 핸들을 사용할 수 없습니다.</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;windows.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;tchar.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;strsafe.h&gt;</span><span class="cp">
</span>
<span class="cp">#define MAX_THREADS 3
#define BUF_SIZE 255
</span>
<span class="n">DWORD</span> <span class="n">WINAPI</span> <span class="nf">MyThreadFunction</span><span class="p">(</span> <span class="n">LPVOID</span> <span class="n">lpParam</span> <span class="p">);</span>
<span class="kt">void</span> <span class="nf">ErrorHandler</span><span class="p">(</span><span class="n">LPTSTR</span> <span class="n">lpszFunction</span><span class="p">);</span>

<span class="c1">// Sample custom data structure for threads to use.</span>
<span class="c1">// This is passed by void pointer so it can be any data type</span>
<span class="c1">// that can be passed using a single void pointer (LPVOID).</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">MyData</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">val1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">val2</span><span class="p">;</span>
<span class="p">}</span> <span class="n">MYDATA</span><span class="p">,</span> <span class="o">*</span><span class="n">PMYDATA</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">_tmain</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">PMYDATA</span> <span class="n">pDataArray</span><span class="p">[</span><span class="n">MAX_THREADS</span><span class="p">];</span>
    <span class="n">DWORD</span>   <span class="n">dwThreadIdArray</span><span class="p">[</span><span class="n">MAX_THREADS</span><span class="p">];</span>
    <span class="n">HANDLE</span>  <span class="n">hThreadArray</span><span class="p">[</span><span class="n">MAX_THREADS</span><span class="p">];</span> 

    <span class="c1">// Create MAX_THREADS worker threads.</span>

    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">MAX_THREADS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Allocate memory for thread data.</span>

        <span class="n">pDataArray</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">PMYDATA</span><span class="p">)</span> <span class="n">HeapAlloc</span><span class="p">(</span><span class="n">GetProcessHeap</span><span class="p">(),</span> <span class="n">HEAP_ZERO_MEMORY</span><span class="p">,</span>
                <span class="k">sizeof</span><span class="p">(</span><span class="n">MYDATA</span><span class="p">));</span>

        <span class="k">if</span><span class="p">(</span> <span class="n">pDataArray</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="p">)</span>
        <span class="p">{</span>
           <span class="c1">// If the array allocation fails, the system is out of memory</span>
           <span class="c1">// so there is no point in trying to print an error message.</span>
           <span class="c1">// Just terminate execution.</span>
            <span class="n">ExitProcess</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// Generate unique data for each thread to work with.</span>

        <span class="n">pDataArray</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">val1</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
        <span class="n">pDataArray</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">val2</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">100</span><span class="p">;</span>

        <span class="c1">// Create the thread to begin execution on its own.</span>

        <span class="n">hThreadArray</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">CreateThread</span><span class="p">(</span> 
            <span class="nb">NULL</span><span class="p">,</span>                   <span class="c1">// default security attributes</span>
            <span class="mi">0</span><span class="p">,</span>                      <span class="c1">// use default stack size  </span>
            <span class="n">MyThreadFunction</span><span class="p">,</span>       <span class="c1">// thread function name</span>
            <span class="n">pDataArray</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>          <span class="c1">// argument to thread function </span>
            <span class="mi">0</span><span class="p">,</span>                      <span class="c1">// use default creation flags </span>
            <span class="o">&amp;</span><span class="n">dwThreadIdArray</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>   <span class="c1">// returns the thread identifier </span>

        <span class="c1">// Check the return value for success.</span>
        <span class="c1">// If CreateThread fails, terminate execution. </span>
        <span class="c1">// This will automatically clean up threads and memory. </span>

        <span class="k">if</span> <span class="p">(</span><span class="n">hThreadArray</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> 
        <span class="p">{</span>
           <span class="n">ErrorHandler</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">"CreateThread"</span><span class="p">));</span>
           <span class="n">ExitProcess</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="c1">// End of main thread creation loop.</span>

    <span class="c1">// Wait until all threads have terminated.</span>

    <span class="n">WaitForMultipleObjects</span><span class="p">(</span><span class="n">MAX_THREADS</span><span class="p">,</span> <span class="n">hThreadArray</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">INFINITE</span><span class="p">);</span>

    <span class="c1">// Close all thread handles and free memory allocations.</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">MAX_THREADS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">CloseHandle</span><span class="p">(</span><span class="n">hThreadArray</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">pDataArray</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">HeapFree</span><span class="p">(</span><span class="n">GetProcessHeap</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pDataArray</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
            <span class="n">pDataArray</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>    <span class="c1">// Ensure address is not reused.</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">DWORD</span> <span class="n">WINAPI</span> <span class="nf">MyThreadFunction</span><span class="p">(</span> <span class="n">LPVOID</span> <span class="n">lpParam</span> <span class="p">)</span> 
<span class="p">{</span> 
    <span class="n">HANDLE</span> <span class="n">hStdout</span><span class="p">;</span>
    <span class="n">PMYDATA</span> <span class="n">pDataArray</span><span class="p">;</span>

    <span class="n">TCHAR</span> <span class="n">msgBuf</span><span class="p">[</span><span class="n">BUF_SIZE</span><span class="p">];</span>
    <span class="kt">size_t</span> <span class="n">cchStringSize</span><span class="p">;</span>
    <span class="n">DWORD</span> <span class="n">dwChars</span><span class="p">;</span>

    <span class="c1">// Make sure there is a console to receive output results. </span>

    <span class="n">hStdout</span> <span class="o">=</span> <span class="n">GetStdHandle</span><span class="p">(</span><span class="n">STD_OUTPUT_HANDLE</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">hStdout</span> <span class="o">==</span> <span class="n">INVALID_HANDLE_VALUE</span> <span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>

    <span class="c1">// Cast the parameter to the correct data type.</span>
    <span class="c1">// The pointer is known to be valid because </span>
    <span class="c1">// it was checked for NULL before the thread was created.</span>
 
    <span class="n">pDataArray</span> <span class="o">=</span> <span class="p">(</span><span class="n">PMYDATA</span><span class="p">)</span><span class="n">lpParam</span><span class="p">;</span>

    <span class="c1">// Print the parameter values using thread-safe functions.</span>

    <span class="n">StringCchPrintf</span><span class="p">(</span><span class="n">msgBuf</span><span class="p">,</span> <span class="n">BUF_SIZE</span><span class="p">,</span> <span class="n">TEXT</span><span class="p">(</span><span class="s">"Parameters = %d, %d</span><span class="se">\\</span><span class="s">n"</span><span class="p">),</span> 
        <span class="n">pDataArray</span><span class="o">-&gt;</span><span class="n">val1</span><span class="p">,</span> <span class="n">pDataArray</span><span class="o">-&gt;</span><span class="n">val2</span><span class="p">);</span> 
    <span class="n">StringCchLength</span><span class="p">(</span><span class="n">msgBuf</span><span class="p">,</span> <span class="n">BUF_SIZE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cchStringSize</span><span class="p">);</span>
    <span class="n">WriteConsole</span><span class="p">(</span><span class="n">hStdout</span><span class="p">,</span> <span class="n">msgBuf</span><span class="p">,</span> <span class="p">(</span><span class="n">DWORD</span><span class="p">)</span><span class="n">cchStringSize</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dwChars</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span> 
<span class="p">}</span> 

<span class="kt">void</span> <span class="nf">ErrorHandler</span><span class="p">(</span><span class="n">LPTSTR</span> <span class="n">lpszFunction</span><span class="p">)</span> 
<span class="p">{</span> 
    <span class="c1">// Retrieve the system error message for the last-error code.</span>

    <span class="n">LPVOID</span> <span class="n">lpMsgBuf</span><span class="p">;</span>
    <span class="n">LPVOID</span> <span class="n">lpDisplayBuf</span><span class="p">;</span>
    <span class="n">DWORD</span> <span class="n">dw</span> <span class="o">=</span> <span class="n">GetLastError</span><span class="p">();</span> 

    <span class="n">FormatMessage</span><span class="p">(</span>
        <span class="n">FORMAT_MESSAGE_ALLOCATE_BUFFER</span> <span class="o">|</span> 
        <span class="n">FORMAT_MESSAGE_FROM_SYSTEM</span> <span class="o">|</span>
        <span class="n">FORMAT_MESSAGE_IGNORE_INSERTS</span><span class="p">,</span>
        <span class="nb">NULL</span><span class="p">,</span>
        <span class="n">dw</span><span class="p">,</span>
        <span class="n">MAKELANGID</span><span class="p">(</span><span class="n">LANG_NEUTRAL</span><span class="p">,</span> <span class="n">SUBLANG_DEFAULT</span><span class="p">),</span>
        <span class="p">(</span><span class="n">LPTSTR</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">lpMsgBuf</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span> <span class="p">);</span>

    <span class="c1">// Display the error message.</span>

    <span class="n">lpDisplayBuf</span> <span class="o">=</span> <span class="p">(</span><span class="n">LPVOID</span><span class="p">)</span><span class="n">LocalAlloc</span><span class="p">(</span><span class="n">LMEM_ZEROINIT</span><span class="p">,</span> 
        <span class="p">(</span><span class="n">lstrlen</span><span class="p">((</span><span class="n">LPCTSTR</span><span class="p">)</span> <span class="n">lpMsgBuf</span><span class="p">)</span> <span class="o">+</span> <span class="n">lstrlen</span><span class="p">((</span><span class="n">LPCTSTR</span><span class="p">)</span> <span class="n">lpszFunction</span><span class="p">)</span> <span class="o">+</span> <span class="mi">40</span><span class="p">)</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">TCHAR</span><span class="p">));</span> 
    <span class="n">StringCchPrintf</span><span class="p">((</span><span class="n">LPTSTR</span><span class="p">)</span><span class="n">lpDisplayBuf</span><span class="p">,</span> 
        <span class="n">LocalSize</span><span class="p">(</span><span class="n">lpDisplayBuf</span><span class="p">)</span> <span class="o">/</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">TCHAR</span><span class="p">),</span>
        <span class="n">TEXT</span><span class="p">(</span><span class="s">"%s failed with error %d: %s"</span><span class="p">),</span> 
        <span class="n">lpszFunction</span><span class="p">,</span> <span class="n">dw</span><span class="p">,</span> <span class="n">lpMsgBuf</span><span class="p">);</span> 
    <span class="n">MessageBox</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="p">(</span><span class="n">LPCTSTR</span><span class="p">)</span> <span class="n">lpDisplayBuf</span><span class="p">,</span> <span class="n">TEXT</span><span class="p">(</span><span class="s">"Error"</span><span class="p">),</span> <span class="n">MB_OK</span><span class="p">);</span> 

    <span class="c1">// Free error-handling buffer allocations.</span>

    <span class="n">LocalFree</span><span class="p">(</span><span class="n">lpMsgBuf</span><span class="p">);</span>
    <span class="n">LocalFree</span><span class="p">(</span><span class="n">lpDisplayBuf</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>MyThreadFunction 함수는 특히 multithreaded CRT를 사용하지 않는 경우, 많은 함수가 not thread-safe하기 때문에 C 런타임 라이브러리 (CRT, C run-time library)의 사용을 피합니다. 만약 ThreadProc함수 내에서 CRT를 사용하고 싶다면, _beginthreadex 함수를 대신 사용하세요.</p><p>포인터가 유효하지 않게 되어버리기 때문에, 생성 스레드(새로운 스레드를 생성한 부모 스레드)가 새로운 스레드보다 먼저 종료된다면 지역 변수의 주소를 전달하는 것은 위험합니다. 대신, 동적으로 할당된 메모리에 대한 포인터를 전달하거나 새로운 스레드가 종료될 때까지 생성 스레드를 기다리게 하세요. 데이터는 또한 전역 변수로도 전달될 수도 있습니다. 전역 변수를 사용하면, 일반적으로 여러 스레드의 액세스를 동기화해야 합니다. 더 많은 정보를 보려면 <a href="https://docs.microsoft.com/en-us/windows/win32/procthread/synchronizing-execution-of-multiple-threads">Synchronizing Execution of Multiple Threads</a> 문서를 보세요.</p><p>생성 스레드는 인수로 다음 항목들을 지정할 수 있습니다.</p><ul><li>새로운 스레드에 대한 핸들의 보안 속성들(security attributes)입니다. 이러한 보안 속성에는 핸들이 자식 프로세스에 의해 상속될 수 있는지 아닌지에 대한 여부를 결정하는 inheritance flag를 포함됩니다. 또한 액세스가 허용되기 전에 시스템이 스레드 핸들의 모든 후속 사용에 대한 액세스 검사를 수행하는 데 사용하는 보안 설명자(security descriptor)가 포함됩니다.<li>새로운 스레드의 초기 스택 크기입니다. 스레드의 스택은 프로세스의 메모리 영역에 자동으로 할당됩니다. 시스템은 필요할 때마다 스택의 크기를 늘리며 스레드가 종료될 때 이를 해제합니다. 더 많은 정보를 보려면 <a href="https://docs.microsoft.com/en-us/windows/win32/procthread/thread-stack-size">Thread Stack Size</a> 문서를 보세요.<li>일시 중단(suspended) 상태로 스레드를 생성할 수 있도록 해주는 생성 플래그(creation flag)입니다. 일시 중단되었을 때 스레드는 ResumeThread 함수가 호출되기 전까지 실행되지 않습니다.</ul><p>또한 CreateRemoteThread 함수를 사용하여 스레드를 생성할 수도 있습니다. 이 함수는 디버그 중인 프로세스의 주소 공간 영역에서 실행되는 스레드를 생성하기 위해서 디버거에 의해 사용됩니다.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/win32/'>Win32</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/msdn/" class="post-tag no-text-decoration" >MSDN</a> <a href="/tags/win32/" class="post-tag no-text-decoration" >Win32</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"></div><div class="share-wrapper"> <span class="share-label text-muted mr-1"></span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[MSDN]%20Creating%20Threads%20-%20kangsangyeon&url=https%3A%2F%2Fkangsangyeon.github.io%2Fposts%2Fmsdn-creating-threads%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[MSDN]%20Creating%20Threads%20-%20kangsangyeon&u=https%3A%2F%2Fkangsangyeon.github.io%2Fposts%2Fmsdn-creating-threads%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fkangsangyeon.github.io%2Fposts%2Fmsdn-creating-threads%2F&text=[MSDN]%20Creating%20Threads%20-%20kangsangyeon" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="" data-title-succeed=""> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading"></div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/gitignore_ignore_directory_or_file_diff/">gitignore에서 디렉토리 무시와 파일 무시</a><li><a href="/posts/sysinfoapi.h-GetTickCount64-function/">GetTickCount64 function</a><li><a href="/posts/cpp-Using-SSE-or-SSE2-for-optimization/">Using SSE/SSE2 for optimization</a><li><a href="/posts/DXGI-DXGI_SWAP_CHAIN_DESC/">DXGI_SWAP_CHAIN_DESC structure</a><li><a href="/posts/msdn-creating-processes/">[MSDN] Creating Processes</a></ul></div><div id="access-tags"><div class="panel-heading"></div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/msdn/">MSDN</a> <a class="post-tag" href="/tags/win32/">Win32</a> <a class="post-tag" href="/tags/directx/">DirectX</a> <a class="post-tag" href="/tags/direct3d/">Direct3D</a> <a class="post-tag" href="/tags/dotnet/">dotnet</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/winuser-h/">WinUser.h</a> <a class="post-tag" href="/tags/aot/">aot</a> <a class="post-tag" href="/tags/codeproject/">CodeProject</a> <a class="post-tag" href="/tags/compilation/">compilation</a></div></div></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip></h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/WinGdi.h-PatBlt-function/"><div class="card-body"> <em class="small" data-ts="1647834600" data-df="DD/MM/YYYY" > 21/03/2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>PatBlt function</h3><div class="text-muted small"><p> PatBlt function (wingdi.h) - Win32 apps PatBlt 함수는 지정된 디바이스 컨텍스트에서 현재 선택된 브러시를 사용하여 지정된 사각형을 그립니다. 브러시 색상과 표면 색상(들)은 지정된 래스터 명령을 사용하여 결합됩니다. Syntax 1 2 3 4 5 6 7 8 BOOL PatBlt( [in] HDC hdc,...</p></div></div></a></div><div class="card"> <a href="/posts/processthreadsapi.h-GetThreadTimes-function/"><div class="card-body"> <em class="small" data-ts="1647931500" data-df="DD/MM/YYYY" > 22/03/2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>GetThreadTimes function</h3><div class="text-muted small"><p> GetThreadTimes function (processthreadsapi.h) - Win32 apps 지정된 스레드의 시간 정보를 가져옵니다. Syntax 1 2 3 4 5 6 7 BOOL GetThreadTimes( [in] HANDLE hThread, [out] LPFILETIME lpCreationTime, [out]...</p></div></div></a></div><div class="card"> <a href="/posts/sysinfoapi.h-GetTickCount64-function/"><div class="card-body"> <em class="small" data-ts="1647935760" data-df="DD/MM/YYYY" > 22/03/2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>GetTickCount64 function</h3><div class="text-muted small"><p> GetTickCount64 function (sysinfoapi.h) - Win32 apps 시스템이 시작된 이후 경과된 시간(밀리초)을 가져옵니다. Syntax 1 ULONGLONG GetTickCount64(); Return value 밀리초 값입니다. Remarks GetTickCount 함수의 해상도(resolution)는 일반적...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/msdn-creating-processes/" class="btn btn-outline-primary" prompt=""><p>[MSDN] Creating Processes</p></a> <a href="/posts/WinUser.h-RegisterClassExW/" class="btn btn-outline-primary" prompt=""><p>[WinUser.h] RegisterClassExW function</p></a></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading"></div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/msdn/">MSDN</a> <a class="post-tag" href="/tags/win32/">Win32</a> <a class="post-tag" href="/tags/directx/">DirectX</a> <a class="post-tag" href="/tags/direct3d/">Direct3D</a> <a class="post-tag" href="/tags/dotnet/">dotnet</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/winuser-h/">WinUser.h</a> <a class="post-tag" href="/tags/aot/">aot</a> <a class="post-tag" href="/tags/codeproject/">CodeProject</a> <a class="post-tag" href="/tags/compilation/">compilation</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/kangsangyeon">kangsangyeon</a>.</p></div><div class="footer-right"><p class="mb-0">Using the <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> theme <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>.</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/ko.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
