<!DOCTYPE html><html lang="ko" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Using SSE/SSE2 for optimization" /><meta property="og:locale" content="ko" /><meta name="description" content="Using SSE/SSE2 for optimization" /><meta property="og:description" content="Using SSE/SSE2 for optimization" /><link rel="canonical" href="https://kangsangyeon.github.io/posts/cpp-Using-SSE-or-SSE2-for-optimization/" /><meta property="og:url" content="https://kangsangyeon.github.io/posts/cpp-Using-SSE-or-SSE2-for-optimization/" /><meta property="og:site_name" content="kangsangyeon" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-03-19T23:19:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Using SSE/SSE2 for optimization" /><meta name="google-site-verification" content="idB845j5JM1YkVY8Yu1xeTPMGtzgq_8yqyG09LQzakw" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-03-19T23:19:54+09:00","datePublished":"2022-03-19T23:19:00+09:00","description":"Using SSE/SSE2 for optimization","headline":"Using SSE/SSE2 for optimization","mainEntityOfPage":{"@type":"WebPage","@id":"https://kangsangyeon.github.io/posts/cpp-Using-SSE-or-SSE2-for-optimization/"},"url":"https://kangsangyeon.github.io/posts/cpp-Using-SSE-or-SSE2-for-optimization/"}</script><title>Using SSE/SSE2 for optimization | kangsangyeon</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="kangsangyeon"><meta name="application-name" content="kangsangyeon"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/thumb_molang.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">kangsangyeon</a></div><div class="site-subtitle font-italic">studying game development</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span></span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/kangsangyeon" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/" aria-label="twitter" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['ksyline1997','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> </a> </span> <span>Using SSE/SSE2 for optimization</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="..."> </span> <span id="search-cancel" ></span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Using SSE/SSE2 for optimization</h1><div class="post-meta text-muted"> <span> <em class="" data-ts="1647699540" data-df="DD/MM/YYYY" data-toggle="tooltip" data-placement="bottom"> 19/03/2022 </em> </span> <span> <em class="" data-ts="1647699594" data-df="DD/MM/YYYY" data-toggle="tooltip" data-placement="bottom"> 19/03/2022 </em> </span><div class="d-flex justify-content-between"> <span> <em> <a href="https://github.com/kangsangyeon">kangsangyeon</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1738 "> <em>9 </em> </span></div></div></div><div class="post-content"><p><a href="https://www.codeproject.com/Articles/8440/Using-SSE-SSE2-for-optimization">Using SSE/SSE2 for optimization</a></p><p>최적화 방법 중 하나에 대한 초보자용 소개입니다.</p><p><a href="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/eba98afb-1735-4a6d-925d-066c96ace75b/fast_data_transfer_demo.zip">fast_data_transfer_demo.zip</a></p><h2 id="objective"><span class="mr-2">Objective</span><a href="#objective" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>본 게시물의 목적은 간단한 최적화 방법을 소개하는 것입니다. 나중에 더 많은 글을 투고할 계획입니다.</p><h2 id="introduction"><span class="mr-2">Introduction</span><a href="#introduction" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>본 게시물은 Intel의 SIMD (Single Instruction Multiple Data) extension 기술에 대해 설명합니다. movdqa같이 기존의 방식보다 더 빠르게 데이터를 전송할 수 있는, Intel의 새로운 instruction을 사용하여 최적화합니다.</p><h2 id="recall"><span class="mr-2">Recall</span><a href="#recall" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>시작하기 전에, 우리가 이미 알고 있는 지식들을 상기해봅시다. 요즘, 또는 일반적으로, 우리는 집에서, 또한 산업에서 32비트 프로세서를 사용하고 있습니다. eax, ebx, .. 와 같은 범용 목적의 레지스터들은 32비트입니다. 그리고 sizeof(int) = 4 (bytes) 입니다. 그러나 모든 레지스터들이 32비트인 것은 아니며, 더 많은 비트 길이를 가지는 레지스터들이 있습니다. 10년 전부터, Intel은 64비트를 가지는 8개의 레지스터 mm0, mm1 .. mm7이 있는 MMX extension을 도입했습니다. 그 이후, Intel은 128비트를 가지는 다른 새로운 레지스터 xmm0, xmm1 .. xmm7이 있는 SSE extension을 도입했습니다.</p><h2 id="requirement"><span class="mr-2">Requirement</span><a href="#requirement" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>먼저 자신이 어떤 기기를 사용하고 있는지 알아보세요. Intel P3 이상이어야 합니다. 이 최적화 방법은 기기에 의존적이라는 것을 명심해야 합니다. 이는 자신의 하드웨어가 지원하지 않는다면, 차이를 볼 수 없다는 것을 의미합니다.</p><h2 id="code"><span class="mr-2">Code</span><a href="#code" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>제가 만든 샘플입니다. 콘솔 모드에서 실행될 수 있도록 일부러 간단하게 만들었습니다. 복사 붙여넣기 하지 않고, 독자가 이해하며 스스로 시도해보는 것을 권장합니다.</p><p>데모 코드는 같은 목적으로 제공되는 두 함수의 차이점을 확인시켜 줄 것입니다. 여기서부터 더 많은 설명을 하지 않을 것입니다. 스스로 코드를 보며 코드 내의 주석을 읽어주세요. 이해할 수 있을 것이라 확신합니다. =)</p><p>잠깐! 먼저 브레이크 포인트를 준비하고 인내심을 가지고 기다리세요. 디버깅을 할 때, 다음 두 함수를 모두 step해보면 차이점을 알 수 있을 것입니다.</p><blockquote><p><em>DataTransferTypical</em>은 한 루프에 하나의 int를 복사할 것이고 (<em>sizeof</em>(<em>int</em>) = 4 bytes), 반면 <em>DataTransferOptimised</em>는 한 루프에 한 루프에 4개의 int를 복사할 것입니다 (4 * <em>sizeof</em>(<em>int</em>) = 16 bytes).</p></blockquote><p>Watch 창을 준비하세요. Watch창에서 <code class="language-plaintext highlighter-rouge">piDst, 101</code>을 watch하세요. 그 뒤 어떻게 변하는지 확인하세요.</p><blockquote><p>P.S: 이 코드를 MSVC++로 컴파일하기 위해 processor pack을 설치해야 합니다.</p></blockquote><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="kt">int</span> <span class="nf">DataTransferTypical</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span> <span class="n">piDst</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">piSrc</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">SizeInBytes</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">DataTransferOptimised</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span> <span class="n">piDst</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">piSrc</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">SizeInBytes</span><span class="p">);</span>
</pre></table></code></div></div><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="c1">// stdafx.h : include file for standard system include files,</span>
<span class="c1">//  or project specific include files that are used frequently, but</span>
<span class="c1">//      are changed infrequently</span>
<span class="c1">//</span>

<span class="cp">#if !defined(AFX_STDAFX_H__CCA0779D_0F4D_4A56_A148_738F06155CA8__INCLUDED_)
#define AFX_STDAFX_H__CCA0779D_0F4D_4A56_A148_738F06155CA8__INCLUDED_
</span>
<span class="cp">#if _MSC_VER &gt; 1000
#pragma once
#endif // _MSC_VER &gt; 1000
</span>
<span class="cp">#define WIN32_LEAN_AND_MEAN		// Exclude rarely-used stuff from Windows headers
</span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span>
<span class="c1">// TODO: reference additional headers your program requires here</span>

<span class="c1">//</span>
<span class="c1">// Microsoft Visual C++ will insert additional declarations immediately before the previous line.</span>

<span class="cp">#endif // !defined(AFX_STDAFX_H__CCA0779D_0F4D_4A56_A148_738F06155CA8__INCLUDED_)
</span></pre></table></code></div></div><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">"stdafx.h"</span><span class="cp">
</span>
<span class="cp">#include</span> <span class="cpf">&lt;conio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;cstdio&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;cstdlib&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;ctime&gt;</span><span class="cp">
</span>
<span class="cp">#include</span> <span class="cpf">"malloc.h"</span><span class="cp">
</span>
<span class="cp">#define ITERATION 10
#define DATA_SIZE 0x00100000
</span>
<span class="kt">int</span> <span class="nf">DataTransferTypical</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span> <span class="n">piDst</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">piSrc</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">SizeInBytes</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">DataTransferOptimised</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span> <span class="n">piDst</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">piSrc</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">SizeInBytes</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
	<span class="c1">// 시작 시간과 종료 시간을 기억합니다.</span>
	<span class="c1">// 만약 더 정확한 것을 원한다면, 다른 게시물을 찾아보세요.</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">dwTimeStart</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">dwTimeEnd</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="c1">// 임시 변수입니다.</span>
	<span class="kt">int</span><span class="o">*</span> <span class="n">piSrc</span> <span class="o">=</span> <span class="nb">nullptr</span><span class="p">;</span>
	<span class="kt">int</span><span class="o">*</span> <span class="n">piDst</span> <span class="o">=</span> <span class="nb">nullptr</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">cKey</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">dwDataSizeInBytes</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="o">*</span> <span class="n">DATA_SIZE</span><span class="p">;</span>

	<span class="c1">// 이 코드를 msvc++으로 컴파일하기 위해 processor pack을 설치해야 합니다.</span>

	<span class="n">piSrc</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="n">_aligned_malloc</span><span class="p">(</span><span class="n">dwDataSizeInBytes</span><span class="p">,</span> <span class="n">dwDataSizeInBytes</span><span class="p">);</span>
	<span class="n">piDst</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="n">_aligned_malloc</span><span class="p">(</span><span class="n">dwDataSizeInBytes</span><span class="p">,</span> <span class="n">dwDataSizeInBytes</span><span class="p">);</span>

	<span class="k">do</span>
	<span class="p">{</span>
		<span class="c1">// 초기화 합니다.</span>
		<span class="n">memset</span><span class="p">(</span><span class="n">piSrc</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dwDataSizeInBytes</span><span class="p">);</span>
		<span class="n">memset</span><span class="p">(</span><span class="n">piDst</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dwDataSizeInBytes</span><span class="p">);</span>

		<span class="n">dwTimeStart</span> <span class="o">=</span> <span class="n">clock</span><span class="p">();</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ITERATION</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
			<span class="n">DataTransferTypical</span><span class="p">(</span><span class="n">piDst</span><span class="p">,</span> <span class="n">piSrc</span><span class="p">,</span> <span class="n">dwDataSizeInBytes</span><span class="p">);</span>
		<span class="n">dwTimeEnd</span> <span class="o">=</span> <span class="n">clock</span><span class="p">();</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"== Typical Transfer of %d * %d times of %d bytes data ==</span><span class="se">\\</span><span class="s">n Time Elapsed = ""% d msec</span><span class="se">\\</span><span class="s">n</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span>
		       <span class="n">ITERATION</span><span class="p">,</span> <span class="n">DATA_SIZE</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">),</span> <span class="n">dwTimeEnd</span> <span class="o">-</span> <span class="n">dwTimeStart</span><span class="p">);</span>

		<span class="c1">// 초기화 합니다.</span>
		<span class="n">memset</span><span class="p">(</span><span class="n">piSrc</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dwDataSizeInBytes</span><span class="p">);</span>
		<span class="n">memset</span><span class="p">(</span><span class="n">piDst</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dwDataSizeInBytes</span><span class="p">);</span>

		<span class="n">dwTimeStart</span> <span class="o">=</span> <span class="n">clock</span><span class="p">();</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ITERATION</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
			<span class="n">DataTransferOptimised</span><span class="p">(</span><span class="n">piDst</span><span class="p">,</span> <span class="n">piSrc</span><span class="p">,</span> <span class="n">dwDataSizeInBytes</span><span class="p">);</span>
		<span class="n">dwTimeEnd</span> <span class="o">=</span> <span class="n">clock</span><span class="p">();</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"== Optimised Transfer of %d * %d times of %d bytes data ==</span><span class="se">\\</span><span class="s">n Time Elapsed = % d msec</span><span class="se">\\</span><span class="s">n</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span>
		       <span class="n">ITERATION</span><span class="p">,</span> <span class="n">DATA_SIZE</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">),</span> <span class="n">dwTimeEnd</span> <span class="o">-</span> <span class="n">dwTimeStart</span><span class="p">);</span>

		<span class="n">printf</span><span class="p">(</span><span class="s">"Rerun? (y/n) "</span><span class="p">);</span>
		<span class="n">cKey</span> <span class="o">=</span> <span class="n">getche</span><span class="p">();</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\\</span><span class="s">n</span><span class="se">\\</span><span class="s">n"</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">cKey</span> <span class="o">==</span> <span class="sc">'y'</span><span class="p">);</span>

	<span class="n">_aligned_free</span><span class="p">(</span><span class="n">piSrc</span><span class="p">);</span>
	<span class="n">_aligned_free</span><span class="p">(</span><span class="n">piDst</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#pragma warning(push)
#pragma warning(disable:4018 4102)
</span>
<span class="kt">int</span> <span class="nf">DataTransferTypical</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span> <span class="n">piDst</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">piSrc</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">SizeInBytes</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">dwNumElements</span> <span class="o">=</span> <span class="n">SizeInBytes</span> <span class="o">/</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">dwNumElements</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="c1">// i는 offset입니다.</span>
		<span class="o">*</span><span class="p">(</span><span class="n">piDst</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">piSrc</span> <span class="o">+</span> <span class="n">i</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">DataTransferOptimised</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span> <span class="n">piDst</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">piSrc</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">SizeInBytes</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">dwNumElements</span> <span class="o">=</span> <span class="n">SizeInBytes</span> <span class="o">/</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>

	<span class="c1">// 실제로 사용하지는 않으며 디버깅용 변수입니다.</span>
	<span class="c1">// 반복 횟수를 가집니다.</span>
	<span class="c1">// 또한 packed 데이터의 개수를 의미하기도 합니다.</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">dwNumPacks</span> <span class="o">=</span> <span class="n">dwNumElements</span> <span class="o">/</span> <span class="p">(</span><span class="mi">128</span> <span class="o">/</span> <span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span><span class="p">));</span>

	<span class="n">_asm</span>
		<span class="p">{</span>
		<span class="c1">// cleanup</span>
		<span class="n">pusha</span><span class="p">;</span>

		<span class="nl">begin:</span>
		<span class="c1">// 카운터를 SizeInBytes으로 초기화합니다.</span>
		<span class="n">mov</span> <span class="n">ecx</span><span class="p">,</span> <span class="n">SizeInBytes</span><span class="p">;</span>
		<span class="c1">// destination 포인터를 가져옵니다.</span>
		<span class="n">mov</span> <span class="n">edi</span><span class="p">,</span> <span class="n">piDst</span><span class="p">;</span>
		<span class="c1">// source 포인터를 가져옵니다.</span>
		<span class="n">mov</span> <span class="n">esi</span><span class="p">,</span> <span class="n">piSrc</span><span class="p">;</span>

		<span class="nl">begina:</span>
		<span class="c1">// 카운터가 0이라면, 반복을 종료합니다.</span>
		<span class="n">cmp</span> <span class="n">ecx</span><span class="p">,</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">jz</span> <span class="n">end</span><span class="p">;</span>

		<span class="nl">body:</span>
		<span class="c1">// offset을 계산합니다.</span>
		<span class="n">mov</span> <span class="n">ebx</span><span class="p">,</span> <span class="n">SizeInBytes</span><span class="p">;</span>
		<span class="n">sub</span> <span class="n">ebx</span><span class="p">,</span> <span class="n">ecx</span><span class="p">;</span>
		<span class="c1">// source의 내용을 128비트 레지스터에 복사합니다.</span>
		<span class="n">movdqa</span> <span class="n">xmm1</span><span class="p">,</span> <span class="p">[</span><span class="n">esi</span> <span class="o">+</span> <span class="n">ebx</span><span class="p">];</span>
		<span class="c1">// 128비트 레지스터를 destination에 복사합니다.</span>
		<span class="n">movdqa</span> <span class="p">[</span><span class="n">edi</span> <span class="o">+</span> <span class="n">ebx</span><span class="p">],</span> <span class="n">xmm1</span><span class="p">;</span>

		<span class="nl">bodya:</span>
		<span class="c1">// 우리는 이미 1 packed == 4 * sizeof(int)를 수행했습니다.</span>
		<span class="n">sub</span> <span class="n">ecx</span><span class="p">,</span> <span class="mi">16</span><span class="p">;</span>
		<span class="n">jmp</span> <span class="n">begina</span><span class="p">;</span>

		<span class="nl">end:</span>
		<span class="c1">// cleanup</span>
		<span class="n">popa</span><span class="p">;</span>
		<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#pragma warning(pop)
</span></pre></table></code></div></div><h2 id="finally"><span class="mr-2">Finally</span><a href="#finally" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>이것은 Code Project에서의 제 첫 게시물입니다. 만약 올바르지 않은 것이 있다면 저에게 알려주세요. 또한, 여기에 올려놓은 데모가 초보자들에게 간단히 도움되었으면 합니다. 배움은 즐겁습니다. 그렇죠? =)</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/cpp/'>cpp</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/codeproject/" class="post-tag no-text-decoration" >CodeProject</a> <a href="/tags/cpp/" class="post-tag no-text-decoration" >cpp</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"></div><div class="share-wrapper"> <span class="share-label text-muted mr-1"></span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Using%20SSE/SSE2%20for%20optimization%20-%20kangsangyeon&url=https%3A%2F%2Fkangsangyeon.github.io%2Fposts%2Fcpp-Using-SSE-or-SSE2-for-optimization%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Using%20SSE/SSE2%20for%20optimization%20-%20kangsangyeon&u=https%3A%2F%2Fkangsangyeon.github.io%2Fposts%2Fcpp-Using-SSE-or-SSE2-for-optimization%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fkangsangyeon.github.io%2Fposts%2Fcpp-Using-SSE-or-SSE2-for-optimization%2F&text=Using%20SSE/SSE2%20for%20optimization%20-%20kangsangyeon" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="" data-title-succeed=""> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading"></div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/gitignore_ignore_directory_or_file_diff/">gitignore에서 디렉토리 무시와 파일 무시</a><li><a href="/posts/sysinfoapi.h-GetTickCount64-function/">GetTickCount64 function</a><li><a href="/posts/cpp-Using-SSE-or-SSE2-for-optimization/">Using SSE/SSE2 for optimization</a><li><a href="/posts/DXGI-DXGI_SWAP_CHAIN_DESC/">DXGI_SWAP_CHAIN_DESC structure</a><li><a href="/posts/msdn-creating-processes/">[MSDN] Creating Processes</a></ul></div><div id="access-tags"><div class="panel-heading"></div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/msdn/">MSDN</a> <a class="post-tag" href="/tags/win32/">Win32</a> <a class="post-tag" href="/tags/directx/">DirectX</a> <a class="post-tag" href="/tags/direct3d/">Direct3D</a> <a class="post-tag" href="/tags/dotnet/">dotnet</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/winuser-h/">WinUser.h</a> <a class="post-tag" href="/tags/aot/">aot</a> <a class="post-tag" href="/tags/codeproject/">CodeProject</a> <a class="post-tag" href="/tags/compilation/">compilation</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2"></div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip></h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/python-poetry-introduction/"><div class="card-body"> <em class="small" data-ts="1746810000" data-df="DD/MM/YYYY" > 10/05/2025 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Python 패키지 관리의 진화: Poetry 도입 배경과 사용법</h3><div class="text-muted small"><p> Python 생태계에서 패키지 설정 관리란, 프로젝트의 의존성과 배포 관련 정보를 정의하고 유지하는 일련의 작업을 의미합니다. 여기에는 외부 패키지 버전 지정, 가상 환경 관리, 빌드와 배포 설정, 메타데이터 작성 등이 포함됩니다. Poetry가 등장하기 이전에는 pip, virtualenv, requirements.txt, setup.py 등을 함...</p></div></div></a></div><div class="card"> <a href="/posts/dotnet-jit-vs-aot/"><div class="card-body"> <em class="small" data-ts="1746178080" data-df="DD/MM/YYYY" > 02/05/2025 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>.NET 컴파일 방식 비교: AOT vs JIT</h3><div class="text-muted small"><p> .NET에서는 애플리케이션을 실행 가능한 코드로 변환하는 방식으로 JIT(Just-In-Time)과 AOT(Ahead-Of-Time) 두 가지를 지원합니다. 이 글에서는 두 방식을 비교하고 각각의 특징과 차이점을 정리합니다. 주요 내용은 다음과 같습니다. JIT(Just-In-Time) 컴파일 방식 JIT 컴파일러의 종류 AOT(Ahe...</p></div></div></a></div><div class="card"> <a href="/posts/dotnet-introduction/"><div class="card-body"> <em class="small" data-ts="1745951520" data-df="DD/MM/YYYY" > 30/04/2025 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>.NET 플랫폼 정리: 플랫폼, Standard, 구현체, 그리고 변화</h3><div class="text-muted small"><p> .NET은 Microsoft가 개발한 다양한 유형의 애플리케이션을 위한 개발 플랫폼입니다. 이 글에서는 다음 주제를 다룹니다. .NET 플랫폼이란? .NET의 다양한 구현체들 .NET Standard 사양이란? .NET 5 이전과 이후의 변화 .NET 플랫폼이란? .NET은 애플리케이션 개발을 위한 런타임 환경, 언어, 라이브러...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Direct3D-CheckMultisampleQualityLevels/" class="btn btn-outline-primary" prompt=""><p>CheckMultisampleQualityLevels function</p></a> <a href="/posts/Direct3D-ID3D11RenderTargetView-interface/" class="btn btn-outline-primary" prompt=""><p>ID3D11RenderTargetView interface</p></a></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading"></div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/msdn/">MSDN</a> <a class="post-tag" href="/tags/win32/">Win32</a> <a class="post-tag" href="/tags/directx/">DirectX</a> <a class="post-tag" href="/tags/direct3d/">Direct3D</a> <a class="post-tag" href="/tags/dotnet/">dotnet</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/winuser-h/">WinUser.h</a> <a class="post-tag" href="/tags/aot/">aot</a> <a class="post-tag" href="/tags/codeproject/">CodeProject</a> <a class="post-tag" href="/tags/compilation/">compilation</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/kangsangyeon">kangsangyeon</a>.</p></div><div class="footer-right"><p class="mb-0">Using the <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> theme <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>.</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/ko.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
